<!DOCTYPE html>
<html>
<head>
    <title>REEFSOURCE</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Using the environment as a firsthand storytelling source">

    <link rel="stylesheet" type="text/css" href="css/foundation.css">
    <link rel="stylesheet" type="text/css" href="css/landingpage.css">
    <link rel="stylesheet" type="text/css" href="css/reveal.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
</head>
<body>

<div class="welcome">
    <div class="top-bar">
        <div class="top-bar-left">
            <ul class="dropdown menu" data-dropdown-menu>
                <li class="menu-text">RE<span>EF</span>SOURCE</li>
                <li class="mega-menu"><a data-toggle="mega-menu" href="index.html">LEARN</a></li>
                <li><a href="#">MAP</a></li>
                <li><a href="#">OUR MISSION</a></li>
                <li><a href="#">ABOUT US</a></li>
                <li><a href="#">CONTACT</a></li>
                <li id="sign-up-toggle"><a class="button" href="#" data-reveal-id="modal_signup">&nbsp;SIGN UP&nbsp;</a></li>
            </ul>
        </div>
    </div>
    <div class="land_sub">
        <p id="description">THE CROWD-SOURCING ENVIRONMENTAL PROJECT</p>
        <p id="subdescription">We care about coral reef health.</p>
        <a class="button contribute-button" href="#" data-reveal-id="modal_signup">CONTRIBUTE PHOTOS</a>
    </div>
</div>
<div class="support">
    <ul>
        <img src="img/brown-logo.png" style="height: 60px; transform: translateY(30%);">
        <img src="img/stanford-logo.png">
        <img src="img/columbia-logo.png">
        <img src="img/gopro-logo.png" style="margin-right: 0;">
    </ul>
</div>

<div id="modal_signup" class="reveal-modal" data-reveal aria-labelledby="Sign Up" aria-hidden="true" role="dialog">
    <p id="signup_title">SIGN UP</p>
    <p>By sending us. several text goes here.</p>
    <p><a href="#" class="button" id="customized_sign_in_button">SIGN UP WITH GOOGLE</a></p>

    <!--<p><a href="#" class="button" id="customized_sign_in_button">SIGN UP WITH GOOGLE</a></p>-->
    <a class="close-reveal-modal button" aria-label="Close">&#215;</a>
</div>

<script src="https://apis.google.com/js/client:platform.js?onload=start" async defer></script>

<script src="node_modules/jquery/dist/jquery.min.js"> </script>
<script src="node_modules/foundation-sites/dist/js/foundation.min.js"> </script>
<script src="node_modules/terrific/dist/terrific.min.js"> </script>
<script src="node_modules/what-input/dist/what-input.min.js"> </script>
<script src="node_modules/masonry-layout/dist/masonry.pkgd.min.js"> </script>

<script type="text/javascript" src="js/app.js"></script>

<script>
    $('#customized_sign_in_button').click(function () {
        // signInCallback defined in step 6.
        auth2.grantOfflineAccess().then(signInCallback);
    });

    function signInCallback(authResult) {
        if (authResult['code']) {
            console.log(authResult);
            console.log(authResult['code']);
            // Hide the sign-in button now that the user is authorized, for example:
//            $('#customized_sign_in_button').attr('style', 'display: none');

            // Send the code to the server
            $.ajax({

                type: 'GET',
                url: 'http://coralreefsource.org/api/user/self',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Authorization': authResult['code']
                },
                success: function (result) {
                    console.log(result);
                    localStorage.setItem("auth_token", authResult['code']);
                    console.log("success");
//                    window.location.href = "dashboard.html";
                },
                error: function (err) {
                    var error_code = err.status;
                    if (error_code === 404) {

                        var payload = {
                            "_id": 'dailinshen@gmail.com',
                            'firstname': 'Dailin',
                            'lastname': 'Shen',
                            'email': 'dailinshen@gmail.com',
                            'root': false
                        };
                        $.ajax({
                            type: 'POST',
                            url: 'http://coralreefsource.org/api/users?root=true',
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'Authorization': authResult['code']
                            },
//                            data: JSON.stringify(payload),
                            success: function () {
                                console.log("success");
                            },
                            error: function (err) {
                                console.log('fail creating users');
                                console.log(err);
                            }
                        });
                    }

                    console.log(error_code);
                    console.log(err.status);
                }

//                type: 'POST',
//                url: 'http://example.com/storeauthcode',
//                // Always include an `X-Requested-With` header in every AJAX request,
//                // to protect against CSRF attacks.
//                headers: {
//                    'X-Requested-With': 'XMLHttpRequest'
//                },
//                contentType: 'application/octet-stream; charset=utf-8',
//                success: function(result) {
//                    // Handle or verify the server response.
//                },
//                processData: false,
//                data: authResult['code']
            });
        } else {
            // There was an error.
        }
    }

    function start() {
        gapi.load('auth2', function () {
            auth2 = gapi.auth2.init({
                client_id: '198434096526-c806a42elrrhvl89g6b581tmjvbonu3n.apps.googleusercontent.com',
                scope: 'profile email'
            });
        });
    }

    // terrificjs bootstrap
    (function ($) {
        $(document).ready(function () {
            var $page = $('body');
            var config = {
                dependencyPath: {
                    plugin: 'javascripts/'
                }
            };
            var application = new T.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
</script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-97189138-1', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>
