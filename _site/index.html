<!DOCTYPE html>
<html>
<head>
	<title>REEFSOURCE</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Using the environment as a firsthand storytelling source">
	<link rel="stylesheet" type="text/css" href="css/foundation.css">
	<link rel="stylesheet" type="text/css" href="css/landingpage.css">
	<link rel="stylesheet" type="text/css" href="css/reveal.css">
	<script src="js/libs.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/vendor/foundation.min.js"></script>
	<script type="text/javascript" src="js/jquery-1.4.4.min.js"></script>

	<script>
        // terrificjs bootstrap
        (function($) {
            $(document).ready(function() {
                var $page = $('body');
                var config = {
                    dependencyPath: {
                        plugin: 'javascripts/'
                    }
                }
                var application = new Tc.Application($page, config);
                application.registerModules();
                application.start();
            });
        })(Tc.$);
	</script>
	<!--Google Signin-->
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">

	<script src="https://apis.google.com/js/client:platform.js?onload=start" async defer></script>
	<script>
    	function start() {
			gapi.load('auth2', function() {
				auth2 = gapi.auth2.init({
					client_id: '198434096526-c806a42elrrhvl89g6b581tmjvbonu3n.apps.googleusercontent.com',
                    scope: 'profile email'
				});
			});
		}
	</script>


	<script src="js/masonry.pkgd.js" type="text/javascript"></script>


	<!--<script src="https://apis.google.com/js/api:client.js"></script>-->
	<!--<script>-->

        <!--var googleUser = {};-->
        <!--var startApp = function() {-->
            <!--gapi.load('auth2', function(){-->
                <!--// Retrieve the singleton for the GoogleAuth library and set up the client.-->
                <!--auth2 = gapi.auth2.init({-->
                    <!--client_id: '198434096526-c806a42elrrhvl89g6b581tmjvbonu3n.apps.googleusercontent.com',-->
                    <!--cookiepolicy: 'single_host_origin',-->
                <!--});-->
                <!--console.log(auth2.grantOfflineAccess());-->
                <!--auth2.grantOfflineAccess().then(function(resp){-->
                    <!--var auth_code = resp.code;-->
                    <!--console.log(auth_code);-->
                <!--});-->
             <!--attachSignin(auth2, document.getElementById('customized_sign_in_button'));-->
            <!--});-->
        <!--};-->
        <!--function attachSignin(auth2value, element) {-->
            <!--console.log(auth2value);-->
            <!--console.log(element.id);-->
            <!--auth2.attachClickHandler(element, {},-->
                <!--function(googleUser) {-->
                	<!--console.log(googleUser.Zi.access_token);-->
					<!--console.log(googleUser.getBasicProfile().getName());-->
                	<!--console.log(googleUser.getBasicProfile().getFamilyName());-->
                	<!--localStorage.setItem('email', googleUser.getBasicProfile().getEmail());-->
                	<!--localStorage.setItem('first_name', googleUser.getBasicProfile().getGivenName());-->
                    <!--localStorage.setItem('family_name', googleUser.getBasicProfile().getFamilyName());-->
                	<!--console.log(googleUser.getBasicProfile().getGivenName());-->
                	<!--console.log(googleUser.getBasicProfile().getEmail());-->

                    <!--localStorage.setItem('user_name', googleUser.getBasicProfile().getGivenName());-->
                    <!--signInCallback(auth2value);-->
                <!--}, function(error) {-->
                    <!--alert(JSON.stringify(error, undefined, 2));-->
                <!--}-->
			<!--);-->
        <!--}-->

        <!--function signInCallback(authResult) {-->
            <!--console.log(authResult);-->
            <!--localStorage.setItem("autho_db",authResult);-->
            <!--if (authResult) {-->
                <!--$.ajax({-->
                    <!--type: 'GET',-->
                    <!--url: 'http://coralreefsource.org/api/user/self',-->
                    <!--headers: {-->
                        <!--'X-Requested-With': 'XMLHttpRequest',-->
                        <!--'Authorization': authResult-->
                    <!--},-->
                    <!--success: function(result) {-->
                        <!--console.log(result);-->
                        <!--localStorage.setItem("auth_token", authResult);-->
                        <!--console.log("success");-->
                        <!--window.location.href = "dashboard.html";-->
                    <!--},-->
                    <!--error: function(err){-->
                        <!--var error_code = err.status;-->
                        <!--console.log(err.status);-->
                        <!--if (error_code === 404){-->
                            <!--var payload = {-->
                                <!--"_id": localStorage.getItem('email'),-->
								<!--"firstname": localStorage.getItem("first_name"),-->
								<!--"lastname": localStorage.getItem("family_name")-->
							<!--};-->
							<!--$.ajax({-->
								<!--type: 'POST',-->
                                <!--url: 'http://coralreefsource.org/api/users?root=true',-->
								<!--headers: {-->
                                    <!--'X-Requested-With': 'XMLHttpRequest',-->
                                    <!--'Authorization': 'scitran-user test'-->
								<!--},-->
                                <!--data: JSON.stringify(payload),-->
								<!--success: function () {-->
									<!--$.ajax({-->
                                        <!--type: 'GET',-->
                                        <!--url: 'http://coralreefsource.org/api/users',-->
                                        <!--headers: {-->
                                            <!--'X-Requested-With': 'XMLHttpRequest',-->
                                            <!--'Authorization': authResult-->
                                        <!--},-->
										<!--success: function (result) {-->
											<!--console.log(result);-->
                                        <!--},-->
										<!--error: function (err) {-->
                                            <!--console.log("after creating users");-->
											<!--console.log(err);-->
                                        <!--}-->
									<!--});-->
                                <!--},-->
								<!--error:function (err) {-->
								    <!--console.log("problem with creating users");-->
									<!--console.log(err);-->
                                <!--}-->
							<!--});-->
						<!--}-->
                        <!--console.log(err);-->
                    <!--}-->
                <!--});-->
            <!--} else {-->
                <!--console.log('Authentication failure');-->
            <!--}-->
        <!--}-->
	<!--</script>-->



	<!-- Google Analytics -->
	<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-97189138-1', 'auto');
        ga('send', 'pageview');

	</script>
</head>

<body>

<div class="welcome">
	<div class="top-bar">
	  	<div class="top-bar-left">
	    	<ul class="dropdown menu" data-dropdown-menu>
	      		<li class="menu-text">RE<span>EF</span>SOURCE</li>
	      		<li class="mega-menu"><a data-toggle="mega-menu" href="index.html">MISSION</a></li>
	      		<li><a href="#">HOW IT WORKS</a></li>
				<li><a href="#">MAP</a></li>
	      		<li><a href="#">ABOUT</a></li>
	      		<li><a href="#">CONTACT</a></li>
	      		<li id="sign-up-toggle"><a class="button" href="#" data-reveal-id="modal_signup">&nbsp;SIGN UP&nbsp;</a></li>
	    	</ul>
	  	</div>
	</div>
	<div class="land_sub">
		<p id="description">Crowdsourcing images for coral reef health analysis & storytelling</p>
		<p id="subdescription">Participate today by submitting photos from a recent dive.</p>
		<a class="button contribute-button" href="#" data-reveal-id="modal_signup">CONTRIBUTE PHOTOS</a>
	</div>
</div>
<div class="support">
	<ul>
		<img src="img/brown-logo.png" style="height: 60px; transform: translateY(30%);">
		<img src="img/stanford-logo.png">
		<img src="img/columbia-logo.png">
		<img src="img/gopro-logo.png" style="margin-right: 0;">
	</ul>
</div>

<div class="land_sub">
        <p id="description">OUR MISSION</p>
        <p id="subdescription">The Big Picture:</p>
        <p>In recent years, the headlines continue to be bleak: human impact and climate change is causing mass bleaching events, damaging coral reefs across the world. In 2017, the Great Barrier Reef near Australia experienced <a href="http://www.npr.org/sections/thetwo-way/2017/04/10/523254085/great-barrier-reef-hit-by-bleaching-for-the-second-year-in-a-row" target="_blank">a severe bleaching event</a> for the second consecutive year. Coral reefs are the "canary in the coal mine" for determining the health of ocean-based ecosystems and coastal areas. Not only does a quarter of the oceanâ€™s animals and plants depend on healthy reefs for food and shelter, but entire economies lean on the tourism and fishing industries reliant on thriving coral populations. The need to better understand coral reef health is more vital than ever.</p>
        <br>
        <p id="subdescription">What We Do:</p>
        <p>We believe technology empowers journalists and researchers to use the environment as a firsthand data source. We are engaging the diving community to contibute citizen science to support our participatory storytelling about our environment. To do this, we are both distributing cameras, as well as soliciting for RAW photos from divers to build a crowdsourced dataset of coral reef images. When a diver uploads photos, we run the images through an algorithm to provide a rough health score. As we grow our community, the dataset grows. As the dataset grows, researchers and journalists can gain new understanding about the health of a reef.</p>
    </div>
</div>



<div id="modal_signup" class="reveal-modal" data-reveal aria-labelledby="Sign Up" aria-hidden="true" role="dialog">
  <p id="signup_title">SIGN UP</p>
  <p>By sending us. several text goes here.</p>
	<p><a href="#" class="button" id="customized_sign_in_button">SIGN UP WITH GOOGLE</a></p>

  <!--<p><a href="#" class="button" id="customized_sign_in_button">SIGN UP WITH GOOGLE</a></p>-->
  <a class="close-reveal-modal button" aria-label="Close">&#215;</a>
</div>

<script>
    $('#customized_sign_in_button').click(function() {
        // signInCallback defined in step 6.
        auth2.grantOfflineAccess().then(signInCallback);
    });

    function signInCallback(authResult) {
        if (authResult['code']) {
            console.log(authResult);
			console.log(authResult['code']);
            // Hide the sign-in button now that the user is authorized, for example:
//            $('#customized_sign_in_button').attr('style', 'display: none');

            // Send the code to the server
            $.ajax({

                type: 'GET',
                url: 'http://coralreefsource.org/api/user/self',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Authorization': authResult['code']
                },
                success: function(result) {
                    console.log(result);
                    localStorage.setItem("auth_token", authResult['code']);
                    console.log("success");
//                    window.location.href = "dashboard.html";
                },
                error: function(err) {
                    var error_code = err.status;
                    if (error_code === 404){

                        var payload = {
                                "_id": 'dailinshen@gmail.com',
                                'firstname':'Dailin',
                                'lastname':'Shen',
								'email': 'dailinshen@gmail.com',
								'root': false
                            };
						$.ajax({
							type :'POST',
							url: 'http://coralreefsource.org/api/users?root=true',
							headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'Authorization': authResult['code']
							},
//                            data: JSON.stringify(payload),
							success: function () {
								console.log("success");
                            },
							error: function (err) {
							    console.log('fail creating users');
								console.log(err);
                            }
						});
					}

                    console.log(error_code);
                    console.log(err.status);
                }

//                type: 'POST',
//                url: 'http://example.com/storeauthcode',
//                // Always include an `X-Requested-With` header in every AJAX request,
//                // to protect against CSRF attacks.
//                headers: {
//                    'X-Requested-With': 'XMLHttpRequest'
//                },
//                contentType: 'application/octet-stream; charset=utf-8',
//                success: function(result) {
//                    // Handle or verify the server response.
//                },
//                processData: false,
//                data: authResult['code']
            });
        } else {
            // There was an error.
        }
    }

</script>
<!--<script>startApp();</script>-->

<script type="text/javascript" src="js/jquery.reveal.js"></script>
<script type="text/javascript" src="js/app.js"></script>
</body>
</html>